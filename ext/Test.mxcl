
(defvar *count* 1)
(defvar *fails* 0)

(defun diag (msg) (say "# " msg))

(defun todo (msg)
    (diag (~ "TODO:" msg)))

(defun pass (msg)
    (do
        (say "ok " (stringify *count*) " - " msg)
        (set! *count* (+ *count* 1))
        ()))

(defun fail (msg)
    (do
        (say "not ok " *count* " - " msg)
        (set! *count* (+ *count* 1))
        (set! *fails* (+ *fails* 1))
        ()))

(defun ok (test msg)
    (if (boolify test) (pass msg) (fail msg)))

(defun is (got expected msg)
    (let (result (eq? got expected))
        (do (ok result msg)
            (or result
                (do
                    (diag (~ "Failed test " msg))
                    (diag (~ "       got: " got))
                    (diag (~ "  expected: " expected)))))))

(defun done ()
    (if (!= *fails* 0)
        (do (say (~ "1.." *count*))
            (diag (~ (~ "looks like you failed " *fails*)
                     (~ " test(s) of " *count*))))
        (say (~ "1.." *count*))))

()
