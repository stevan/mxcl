#!perl

use v5.42;
use Test::More;
use MXCL::Strand;

my $source = q[
    (require "Test.mxcl")

    (diag "Addition tests")
    (is (+ 1 2)     3       "... 1 + 2 = 3")
    (is (+ 10 20)   30      "... 10 + 20 = 30")
    (is (+ 1.5 2.5) 4       "... 1.5 + 2.5 = 4")
    (is (+ -5 10)   5       "... -5 + 10 = 5")
    (is (+ -5 -3)   -8      "... -5 + -3 = -8")
    (is (+ 0 0)     0       "... 0 + 0 = 0")

    (diag "Subtraction tests")
    (is (- 5 3)     2       "... 5 - 3 = 2")
    (is (- 3 5)     -2      "... 3 - 5 = -2")
    (is (- 10.5 0.5) 10     "... 10.5 - 0.5 = 10")
    (is (- 0 5)     -5      "... 0 - 5 = -5")
    (is (- -3 -5)   2       "... -3 - -5 = 2")

    (diag "Multiplication tests")
    (is (* 3 4)     12      "... 3 * 4 = 12")
    (is (* 2.5 4)   10      "... 2.5 * 4 = 10")
    (is (* -3 4)    -12     "... -3 * 4 = -12")
    (is (* -3 -4)   12      "... -3 * -4 = 12")
    (is (* 5 0)     0       "... 5 * 0 = 0")

    (diag "Division tests")
    (is (/ 10 2)    5       "... 10 / 2 = 5")
    (is (/ 7 2)     3.5     "... 7 / 2 = 3.5")
    (is (/ 1 4)     0.25    "... 1 / 4 = 0.25")
    (is (/ -10 2)   -5      "... -10 / 2 = -5")
    (is (/ 0 5)     0       "... 0 / 5 = 0")

    (diag "Modulo tests")
    (is (% 10 3)    1       "... 10 % 3 = 1")
    (is (% 15 5)    0       "... 15 % 5 = 0")
    (is (% 7 4)     3       "... 7 % 4 = 3")
    (is (% 10 10)   0       "... 10 % 10 = 0")

    (diag "Nested arithmetic tests")
    (is (+ 1 (* 2 3))               7   "... 1 + (2 * 3) = 7")
    (is (* (+ 1 2) (+ 3 4))         21  "... (1+2) * (3+4) = 21")
    (is (- (* 10 10) (+ 50 50))     0   "... (10*10) - (50+50) = 0")
    (is (/ (+ 10 20) (- 10 5))      6   "... (10+20) / (10-5) = 6")
    (is (* 2 (- 20 5))              30  "... 2 * (20-5) = 30")
    (is (* 2 (- (* 10 2) 5))        30  "... 2 * ((10*2)-5) = 30")
    (is (* (- 3.2 1.2) (- (* 10 2) 5)) 30 "... (3.2-1.2) * ((10*2)-5) = 30")

    (done)
];

my $kont = MXCL::Strand->new->load($source)->run;
unless ($kont->effect isa MXCL::Effect::Halt) {
    die "EXPECTED HALT, GOT! ", $kont->stringify;
}
